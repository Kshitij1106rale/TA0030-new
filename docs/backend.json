{
  "entities": {
    "CandidateProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CandidateProfile",
      "type": "object",
      "description": "Represents a candidate's profile, including personal details, verification status, and calculated scores. This entity links to all related information about a candidate.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CandidateProfile entity."
        },
        "email": {
          "type": "string",
          "description": "The candidate's email address for contact and display purposes. (Not for authentication)",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the candidate."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The contact phone number of the candidate."
        },
        "address": {
          "type": "string",
          "description": "The current residential address of the candidate."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The candidate's date of birth.",
          "format": "date"
        },
        "profileStatus": {
          "type": "string",
          "description": "The current status of the candidate's profile in the verification process (e.g., 'pending_documents', 'processing', 'review_pending', 'verified', 'rejected')."
        },
        "trustScore": {
          "type": "number",
          "description": "The calculated trust score for the candidate, ranging from 0 to 100."
        },
        "fraudRiskScore": {
          "type": "number",
          "description": "The calculated fraud risk score for the candidate, ranging from 0 to 100."
        },
        "riskAlerts": {
          "type": "array",
          "description": "A list of strings describing any detected risk alerts or red flags.",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the candidate profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the candidate profile was last updated.",
          "format": "date-time"
        },
        "documentIds": {
          "type": "array",
          "description": "References to Document entities associated with this candidate. (Relationship: CandidateProfile 1:N Document)",
          "items": {
            "type": "string"
          }
        },
        "extractedDataId": {
          "type": "string",
          "description": "Reference to the ExtractedData entity containing all OCR-extracted information for this candidate. (Relationship: CandidateProfile 1:1 ExtractedData)"
        },
        "verificationWorkflowId": {
          "type": "string",
          "description": "Reference to the VerificationWorkflow entity tracking the progress of AI agent processing for this candidate. (Relationship: CandidateProfile 1:1 VerificationWorkflow)"
        }
      },
      "required": [
        "id",
        "email",
        "fullName",
        "profileStatus",
        "createdAt",
        "updatedAt"
      ]
    },
    "HRProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HRProfile",
      "type": "object",
      "description": "Represents an HR personnel's profile within the VeriHire AI system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HRProfile entity."
        },
        "email": {
          "type": "string",
          "description": "The HR's email address for contact and display purposes. (Not for authentication)",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the HR personnel."
        },
        "companyName": {
          "type": "string",
          "description": "The name of the company the HR personnel belongs to."
        },
        "department": {
          "type": "string",
          "description": "The department within the company where the HR personnel works."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the HR profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the HR profile was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "fullName",
        "companyName",
        "createdAt",
        "updatedAt"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document uploaded by a candidate, such as a resume, ID proof, or certificate.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Document entity."
        },
        "candidateProfileId": {
          "type": "string",
          "description": "Reference to the CandidateProfile this document belongs to. (Relationship: CandidateProfile 1:N Document)"
        },
        "documentType": {
          "type": "string",
          "description": "The type of document (e.g., 'Resume', 'ID_Proof', 'Certificate', 'Experience_Letter')."
        },
        "fileName": {
          "type": "string",
          "description": "The original file name of the uploaded document."
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL or path where the document file is stored.",
          "format": "uri"
        },
        "uploadDate": {
          "type": "string",
          "description": "Timestamp indicating when the document was uploaded.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The processing status of the document (e.g., 'uploaded', 'processing_ocr', 'ocr_completed', 'ocr_failed')."
        }
      },
      "required": [
        "id",
        "candidateProfileId",
        "documentType",
        "fileName",
        "fileUrl",
        "uploadDate",
        "status"
      ]
    },
    "ExtractedData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExtractedData",
      "type": "object",
      "description": "Contains structured data extracted by OCR from various documents belonging to a candidate.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ExtractedData entity."
        },
        "candidateProfileId": {
          "type": "string",
          "description": "Reference to the CandidateProfile for which this data was extracted. (Relationship: CandidateProfile 1:1 ExtractedData)"
        },
        "extractionDate": {
          "type": "string",
          "description": "Timestamp indicating when the data extraction process was completed.",
          "format": "date-time"
        },
        "candidateName": {
          "type": "string",
          "description": "The full name of the candidate extracted from documents."
        },
        "contactEmail": {
          "type": "string",
          "description": "The contact email extracted from documents.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "The phone number extracted from documents."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The date of birth extracted from identity documents.",
          "format": "date"
        },
        "addresses": {
          "type": "array",
          "description": "A list of addresses extracted from various documents.",
          "items": {
            "type": "string"
          }
        },
        "educationEntryIds": {
          "type": "array",
          "description": "References to EducationEntry entities detailing the candidate's education. (Relationship: ExtractedData 1:N EducationEntry)",
          "items": {
            "type": "string"
          }
        },
        "experienceEntryIds": {
          "type": "array",
          "description": "References to ExperienceEntry entities detailing the candidate's work history. (Relationship: ExtractedData 1:N ExperienceEntry)",
          "items": {
            "type": "string"
          }
        },
        "skills": {
          "type": "array",
          "description": "A list of skills extracted from resumes or certificates.",
          "items": {
            "type": "string"
          }
        },
        "idProofNumber": {
          "type": "string",
          "description": "The identification number extracted from an ID proof document."
        },
        "idProofType": {
          "type": "string",
          "description": "The type of ID proof document (e.g., 'Passport', 'Driver_License')."
        }
      },
      "required": [
        "id",
        "candidateProfileId",
        "extractionDate",
        "candidateName"
      ]
    },
    "EducationEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EducationEntry",
      "type": "object",
      "description": "Represents a single educational qualification extracted from a candidate's documents.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the EducationEntry entity."
        },
        "extractedDataId": {
          "type": "string",
          "description": "Reference to the ExtractedData entity this education entry belongs to. (Relationship: ExtractedData 1:N EducationEntry)"
        },
        "institution": {
          "type": "string",
          "description": "The name of the educational institution."
        },
        "degree": {
          "type": "string",
          "description": "The degree, diploma, or certification obtained."
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the education period.",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The end date or graduation date of the education period.",
          "format": "date"
        }
      },
      "required": [
        "id",
        "extractedDataId",
        "institution",
        "degree",
        "startDate"
      ]
    },
    "ExperienceEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExperienceEntry",
      "type": "object",
      "description": "Represents a single work experience entry extracted from a candidate's documents.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ExperienceEntry entity."
        },
        "extractedDataId": {
          "type": "string",
          "description": "Reference to the ExtractedData entity this experience entry belongs to. (Relationship: ExtractedData 1:N ExperienceEntry)"
        },
        "company": {
          "type": "string",
          "description": "The name of the company where the candidate worked."
        },
        "title": {
          "type": "string",
          "description": "The job title held at the company."
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the employment period.",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the employment period.",
          "format": "date"
        },
        "description": {
          "type": "string",
          "description": "A brief description of responsibilities and achievements in this role."
        }
      },
      "required": [
        "id",
        "extractedDataId",
        "company",
        "title",
        "startDate"
      ]
    },
    "VerificationWorkflow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VerificationWorkflow",
      "type": "object",
      "description": "Tracks the status and results of the agentic workflow for processing a candidate's verification.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VerificationWorkflow entity."
        },
        "candidateProfileId": {
          "type": "string",
          "description": "Reference to the CandidateProfile whose verification is being tracked. (Relationship: CandidateProfile 1:1 VerificationWorkflow)"
        },
        "overallStatus": {
          "type": "string",
          "description": "The overall status of the entire verification workflow (e.g., 'pending', 'in_progress', 'completed', 'failed')."
        },
        "agentDocumentExtractionStatus": {
          "type": "string",
          "description": "Status of the Document Extraction agent (e.g., 'pending', 'in_progress', 'completed', 'failed', 'skipped')."
        },
        "agentDataComparisonStatus": {
          "type": "string",
          "description": "Status of the Data Comparison agent (e.g., 'pending', 'in_progress', 'completed', 'failed', 'skipped')."
        },
        "agentFraudDetectionStatus": {
          "type": "string",
          "description": "Status of the Fraud Detection agent (e.g., 'pending', 'in_progress', 'completed', 'failed', 'skipped')."
        },
        "agentTrustScoreGenerationStatus": {
          "type": "string",
          "description": "Status of the Trust Score Generation agent (e.g., 'pending', 'in_progress', 'completed', 'failed', 'skipped')."
        },
        "lastUpdatedAt": {
          "type": "string",
          "description": "Timestamp indicating the last update to any status within this workflow.",
          "format": "date-time"
        },
        "mismatchIds": {
          "type": "array",
          "description": "References to Mismatch entities detailing any discrepancies found during verification. (Relationship: VerificationWorkflow 1:N Mismatch)",
          "items": {
            "type": "string"
          }
        },
        "employmentGapIds": {
          "type": "array",
          "description": "References to EmploymentGap entities detailing any employment gaps found. (Relationship: VerificationWorkflow 1:N EmploymentGap)",
          "items": {
            "type": "string"
          }
        },
        "systemNotes": {
          "type": "array",
          "description": "A chronological log of important events or actions within the workflow.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "candidateProfileId",
        "overallStatus",
        "lastUpdatedAt"
      ]
    },
    "Mismatch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Mismatch",
      "type": "object",
      "description": "Details a specific data mismatch or discrepancy detected during the verification process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Mismatch entity."
        },
        "verificationWorkflowId": {
          "type": "string",
          "description": "Reference to the VerificationWorkflow entity this mismatch belongs to. (Relationship: VerificationWorkflow 1:N Mismatch)"
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the detected mismatch."
        },
        "type": {
          "type": "string",
          "description": "The type of mismatch (e.g., 'date_mismatch', 'name_discrepancy', 'employment_gap_flag')."
        },
        "relatedDocumentIds": {
          "type": "array",
          "description": "References to Document entities that are relevant to this mismatch. (Relationship: Mismatch N:N Document)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "verificationWorkflowId",
        "description",
        "type"
      ]
    },
    "EmploymentGap": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmploymentGap",
      "type": "object",
      "description": "Details a detected gap in a candidate's employment history.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the EmploymentGap entity."
        },
        "verificationWorkflowId": {
          "type": "string",
          "description": "Reference to the VerificationWorkflow entity this employment gap belongs to. (Relationship: VerificationWorkflow 1:N EmploymentGap)"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the employment gap.",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the employment gap.",
          "format": "date"
        },
        "durationMonths": {
          "type": "number",
          "description": "The duration of the employment gap in months."
        },
        "reason": {
          "type": "string",
          "description": "The candidate-provided reason for the employment gap, if available."
        }
      },
      "required": [
        "id",
        "verificationWorkflowId",
        "startDate",
        "endDate",
        "durationMonths"
      ]
    },
    "HiringDecision": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "HiringDecision",
      "type": "object",
      "description": "Records the final hiring decision made by an HR personnel regarding a specific candidate.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the HiringDecision entity."
        },
        "candidateProfileId": {
          "type": "string",
          "description": "Reference to the CandidateProfile on which the decision was made. (Relationship: CandidateProfile 1:N HiringDecision)"
        },
        "hrProfileId": {
          "type": "string",
          "description": "Reference to the HRProfile who made this decision. (Relationship: HRProfile 1:N HiringDecision)"
        },
        "decision": {
          "type": "string",
          "description": "The decision made (e.g., 'approved', 'rejected', 'pending_review')."
        },
        "decisionDate": {
          "type": "string",
          "description": "Timestamp indicating when the decision was made.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Any additional notes or comments regarding the decision."
        },
        "reportUrl": {
          "type": "string",
          "description": "URL to a generated report related to this hiring decision (simulated PDF report).",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "candidateProfileId",
        "hrProfileId",
        "decision",
        "decisionDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/hr_profiles/{hrProfileId}",
        "definition": {
          "entityName": "HRProfile",
          "schema": {
            "$ref": "#/backend/entities/HRProfile"
          },
          "description": "Stores individual HR personnel profiles. The document ID (`hrProfileId`) matches the HR user's UID. This collection also serves as a role marker for HR personnel. Accessible only by the owning HR.",
          "params": [
            {
              "name": "hrProfileId",
              "description": "The unique identifier for the HRProfile, which must match the authenticated user's UID (request.auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}",
        "definition": {
          "entityName": "CandidateProfile",
          "schema": {
            "$ref": "#/backend/entities/CandidateProfile"
          },
          "description": "Stores individual candidate profiles. The document ID (`candidateProfileId`) matches the candidate user's UID. This collection also serves as a role marker for candidates. Editable by the owning candidate, readable by all HR personnel.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier for the CandidateProfile, which must match the authenticated user's UID (request.auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores documents uploaded by a candidate. Documents include the `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the parent CandidateProfile."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the Document entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/extracted_data/{extractedDataId}",
        "definition": {
          "entityName": "ExtractedData",
          "schema": {
            "$ref": "#/backend/entities/ExtractedData"
          },
          "description": "Contains structured data extracted by OCR from a candidate's documents. The entity includes the `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel. For 1:1 relationship, `extractedDataId` may often match `candidateProfileId`.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the parent CandidateProfile."
            },
            {
              "name": "extractedDataId",
              "description": "The unique identifier for the ExtractedData entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/extracted_data/{extractedDataId}/education_entries/{educationEntryId}",
        "definition": {
          "entityName": "EducationEntry",
          "schema": {
            "$ref": "#/backend/entities/EducationEntry"
          },
          "description": "Represents a single educational qualification. Includes denormalized `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the grandparent CandidateProfile, denormalized for authorization."
            },
            {
              "name": "extractedDataId",
              "description": "The unique identifier of the parent ExtractedData."
            },
            {
              "name": "educationEntryId",
              "description": "The unique identifier for the EducationEntry entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/extracted_data/{extractedDataId}/experience_entries/{experienceEntryId}",
        "definition": {
          "entityName": "ExperienceEntry",
          "schema": {
            "$ref": "#/backend/entities/ExperienceEntry"
          },
          "description": "Represents a single work experience entry. Includes denormalized `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the grandparent CandidateProfile, denormalized for authorization."
            },
            {
              "name": "extractedDataId",
              "description": "The unique identifier of the parent ExtractedData."
            },
            {
              "name": "experienceEntryId",
              "description": "The unique identifier for the ExperienceEntry entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/verification_workflows/{verificationWorkflowId}",
        "definition": {
          "entityName": "VerificationWorkflow",
          "schema": {
            "$ref": "#/backend/entities/VerificationWorkflow"
          },
          "description": "Tracks the status and results of the agentic workflow for a candidate's verification. Includes `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel. For 1:1 relationship, `verificationWorkflowId` may often match `candidateProfileId`.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the parent CandidateProfile."
            },
            {
              "name": "verificationWorkflowId",
              "description": "The unique identifier for the VerificationWorkflow entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/verification_workflows/{verificationWorkflowId}/mismatches/{mismatchId}",
        "definition": {
          "entityName": "Mismatch",
          "schema": {
            "$ref": "#/backend/entities/Mismatch"
          },
          "description": "Details a specific data mismatch or discrepancy detected. Includes denormalized `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the grandparent CandidateProfile, denormalized for authorization."
            },
            {
              "name": "verificationWorkflowId",
              "description": "The unique identifier of the parent VerificationWorkflow."
            },
            {
              "name": "mismatchId",
              "description": "The unique identifier for the Mismatch entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/verification_workflows/{verificationWorkflowId}/employment_gaps/{employmentGapId}",
        "definition": {
          "entityName": "EmploymentGap",
          "schema": {
            "$ref": "#/backend/entities/EmploymentGap"
          },
          "description": "Details a detected gap in a candidate's employment history. Includes denormalized `candidateProfileId` for authorization independence. Accessible by the owning candidate and all HR personnel.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the grandparent CandidateProfile, denormalized for authorization."
            },
            {
              "name": "verificationWorkflowId",
              "description": "The unique identifier of the parent VerificationWorkflow."
            },
            {
              "name": "employmentGapId",
              "description": "The unique identifier for the EmploymentGap entity."
            }
          ]
        }
      },
      {
        "path": "/candidate_profiles/{candidateProfileId}/hiring_decisions/{hiringDecisionId}",
        "definition": {
          "entityName": "HiringDecision",
          "schema": {
            "$ref": "#/backend/entities/HiringDecision"
          },
          "description": "Records the final hiring decision made by an HR personnel regarding a specific candidate. Includes `candidateProfileId` and `hrProfileId` for authorization independence. Readable by the candidate it concerns and all HR personnel. Writable only by the HR personnel who made the decision.",
          "params": [
            {
              "name": "candidateProfileId",
              "description": "The unique identifier of the parent CandidateProfile."
            },
            {
              "name": "hiringDecisionId",
              "description": "The unique identifier for the HiringDecision entity."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure for VeriHire AI prioritizes Authorization Independence and Query-Agnostic Security Posture (QAP) to enable simple, robust, and easily debuggable security rules. The core strategy revolves around a strict hierarchical path structure for user-owned data and denormalization of authorization-critical fields.\n\n**Authorization Independence via Denormalization:**\n\n1.  **HR and Candidate Profiles as Root Authorities:** Both `/hr_profiles/{hrProfileId}` and `/candidate_profiles/{candidateProfileId}` serve as root collections for their respective user types. The document ID (`hrProfileId` or `candidateProfileId`) MUST correspond to `request.auth.uid`. This allows rules to quickly identify the user's role by checking for document existence (`exists(/hr_profiles/$(request.auth.uid))`) or direct ownership (`request.auth.uid == resource.data.id`) without expensive `get()` calls.\n2.  **Explicit Denormalization in Subcollections:**\n    *   For subcollections like `/candidate_profiles/{candidateProfileId}/documents/{documentId}`, `/candidate_profiles/{candidateProfileId}/extracted_data/{extractedDataId}`, and `/candidate_profiles/{candidateProfileId}/verification_workflows/{verificationWorkflowId}`, the `candidateProfileId` is naturally present in the path and also explicitly stored within the document itself (as per the provided schemas for `Document`, `ExtractedData`, `VerificationWorkflow`). This allows rules to directly compare `request.auth.uid` with `resource.data.candidateProfileId` or the path's `{candidateProfileId}` wildcard.\n    *   For deeply nested subcollections like `EducationEntry`, `ExperienceEntry`, `Mismatch`, and `EmploymentGap`, which are children of `ExtractedData` or `VerificationWorkflow`, the `candidateProfileId` (which is the ultimate owner) is CRITICALLY denormalized into *each document*. For example, an `EducationEntry` document will contain its own `id`, `extractedDataId`, and a denormalized `candidateProfileId`. This ensures that any access request to these subcollection documents can be authorized by checking `request.auth.uid == resource.data.candidateProfileId` without traversing up the parent hierarchy using `get()`.\n    *   The `HiringDecision` entity explicitly contains both `candidateProfileId` (from the path and schema) and `hrProfileId` (from the schema), making authorization for both the candidate (to view their decision) and the HR (to view/create/edit their own decisions) completely independent of parent document lookups.\n\n**Query-Agnostic Security Posture (QAPs):**\n\n1.  **Structural Segregation for Roles:** The top-level `hr_profiles` and `candidate_profiles` collections inherently separate distinct user roles. Rules can easily determine if a user is an HR or a Candidate by checking for the existence of their UID-matched document in these collections. This allows for broad read access for HRs across all candidate data, while candidates only see their own.\n2.  **Homogeneous Security within Collections:** All documents within a given collection or subcollection share the same security posture. For instance, all documents in `/candidate_profiles/{candidateProfileId}/documents` are owned by `{candidateProfileId}` and viewable by HRs. This uniformity simplifies rules; a rule applied to a collection applies to all documents within it without complex conditional logic.\n3.  **Secure List Operations:**\n    *   HRs can securely `list` all documents in `/candidate_profiles` and all its subcollections for any candidate, as their role is authenticated at the top level and all relevant documents contain the `candidateProfileId` for verification. This ensures that a `list` query from an HR will only return data they are authorized to see (all candidates).\n    *   Candidates can only `list` documents within their *own* profile's hierarchy (e.g., `/candidate_profiles/$(request.auth.uid)/documents`), as the rules will enforce that `{candidateProfileId}` must match `request.auth.uid`. This pattern effectively restricts 'list' to 'get my own collection' for candidates, ensuring no unauthorized cross-user data leakage.\n\nThis design effectively minimizes rule complexity by externalizing authorization logic into the data structure itself, leading to more maintainable, performant, and secure Firestore rules."
  }
}